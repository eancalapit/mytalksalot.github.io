name: Deploy React App

on:
  push:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm install
      
      - name: Create missing configs
        run: |
          # Create tsconfig.json if missing
          if [ ! -f "tsconfig.json" ]; then
            echo '{
              "compilerOptions": {
                "target": "ES2020",
                "useDefineForClassFields": true,
                "lib": ["ES2020", "DOM", "DOM.Iterable"],
                "module": "ESNext",
                "skipLibCheck": true,
                "moduleResolution": "bundler",
                "allowImportingTsExtensions": true,
                "resolveJsonModule": true,
                "isolatedModules": true,
                "noEmit": true,
                "jsx": "react-jsx",
                "strict": true
              },
              "include": ["src"],
              "references": [{ "path": "./tsconfig.node.json" }]
            }' > tsconfig.json
          fi
          
          # Create tsconfig.node.json if missing
          if [ ! -f "tsconfig.node.json" ]; then
            echo '{
              "compilerOptions": {
                "composite": true,
                "skipLibCheck": true,
                "module": "ESNext",
                "moduleResolution": "bundler",
                "allowSyntheticDefaultImports": true
              },
              "include": ["vite.config.ts"]
            }' > tsconfig.node.json
          fi
      
      - name: Build
        run: npm run build
      
      - name: Debug build output
        run: |
          echo "Build output structure:"
          ls -la dist/
          echo "--- index.html content:"
          head -20 dist/index.html
      
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: dist
          clean: true
